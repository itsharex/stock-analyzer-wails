# 决策先锋策略回测引擎实现计划

为了验证“决策先锋”策略的有效性，我将实现一个基于历史信号的回测分析功能。该功能将扫描过去 60 天的信号，计算其后续 5 日的表现，并生成统计报告。

## 1. 后端实现 (Go)

### 1.1 数据模型 (Models)
- 在 `models/stock.go` 中添加 `SignalAnalysisResult` 结构体，用于返回统计结果（总数、胜率、收益率等）。

### 1.2 仓库层 (Repositories)
- 修改 `repositories/money_flow_repository.go`:
    - 添加 `GetSignalsByDateRange(startDate, endDate string)` 方法，用于按日期范围查询“决策先锋”策略的历史信号。

### 1.3 服务层 (Services)
- 修改 `services/strategy_service.go`:
    - 暴露 `GetSignalsByDateRange` 方法供回测服务调用。
- 修改 `services/backtest_service.go`:
    - 更新 `BacktestService` 结构体，注入 `StrategyService` 以获取历史信号。
    - 实现核心方法 `AnalyzePastSignals(days int)`:
        1.  获取过去 `days` 天（如 60 天）的所有“决策先锋”信号。
        2.  遍历每个信号，调用 `StockService.GetKLineData` 获取信号发出后的 K 线数据。
        3.  计算每个信号的 T+5 日收益率（`(Close[T+5] - Close[T]) / Close[T]`）。
        4.  统计胜率（收益 > 0 的比例）、平均收益率、最大亏损等指标。
        5.  打印控制台报告并返回结果对象。

### 1.4 应用程序入口 (App)
- 修改 `app.go`:
    - 在 `NewApp` 中初始化 `BacktestService` 时传入 `StrategyService`。
    - 绑定新方法 `AnalyzePastSignals` 供前端调用。

## 2. 前端实现 (React + TypeScript)

### 2.1 类型定义 & API Hook
- 修改 `frontend/src/types/index.ts`: 添加 `SignalAnalysisResult` 类型定义。
- 修改 `frontend/src/hooks/useWailsAPI.ts`: 添加 `analyzePastSignals` 方法。

### 2.2 界面开发
- 修改 `frontend/src/pages/DecisionPioneerPage.tsx`:
    - 在页面顶部栏（Top Bar）添加一个 **“历史统计”** 按钮。
    - 点击按钮后弹出一个模态框（Modal），显示回测统计卡片。
    - 卡片内容包括：分析的信号总数、胜率、平均收益率、最大回撤等关键指标，数据由后端实时计算返回。

## 3. 验证计划
- 运行应用，进入“决策先锋”页面。
- 点击“历史统计”按钮，确认后端控制台输出了分析报告。
- 确认前端弹出的卡片显示了正确的统计数据。
