# 测试与验证指南

本文档说明如何测试和验证A股股票分析AI-Agent应用的各项功能。

## 测试环境准备

### 1. 确认环境配置

```bash
# 检查Go版本
go version  # 应显示 go1.22.0 或更高

# 检查Node.js版本
node -v     # 应显示 v18.0.0 或更高

# 检查Wails CLI
wails version  # 应显示 v2.11.0 或更高
```

### 2. 配置测试环境变量

创建 `.env` 文件：
```bash
OPENAI_API_KEY=your-test-api-key
```

## 功能测试清单

### 一、后端服务测试

#### 1. 股票数据获取服务

**测试用例1：正常股票代码查询**
- 输入：`600519`（贵州茅台）
- 预期：返回完整的股票数据，包括价格、涨跌幅、成交量等
- 验证点：
  - 股票代码正确
  - 股票名称正确
  - 所有数值字段有效（非零、非负）

**测试用例2：无效股票代码**
- 输入：`999999`（不存在的代码）
- 预期：返回错误信息"未找到股票代码"
- 验证点：错误处理正确

**测试用例3：空股票代码**
- 输入：空字符串
- 预期：返回错误信息"股票代码不能为空"
- 验证点：输入验证正确

**测试用例4：多个常用股票**
测试以下股票代码是否能正常获取数据：
- `600519` - 贵州茅台
- `000001` - 平安银行
- `600036` - 招商银行
- `000858` - 五粮液
- `601318` - 中国平安

#### 2. AI分析服务

**测试用例1：完整分析报告生成**
- 输入：有效的股票数据
- 预期：生成包含以下部分的分析报告：
  - 分析摘要
  - 基本面分析
  - 技术面分析
  - 投资建议
  - 风险等级
  - 目标价位
- 验证点：
  - 所有字段非空
  - 内容专业、合理
  - 生成时间正确

**测试用例2：快速分析**
- 输入：有效的股票数据
- 预期：返回简短的分析文本（100字以内）
- 验证点：
  - 响应时间 < 30秒
  - 内容简洁明了

**测试用例3：API密钥错误**
- 输入：错误的OpenAI API密钥
- 预期：返回明确的错误信息
- 验证点：错误处理友好

### 二、前端界面测试

#### 1. 股票搜索组件

**测试用例1：输入验证**
- 操作：输入空格或特殊字符
- 预期：显示错误提示
- 验证点：输入框验证正确

**测试用例2：快捷股票选择**
- 操作：点击常用股票按钮
- 预期：自动填充股票代码到输入框
- 验证点：交互流畅

**测试用例3：键盘快捷键**
- 操作：输入股票代码后按Enter键
- 预期：自动触发查询
- 验证点：键盘事件处理正确

#### 2. 股票信息展示

**测试用例1：数据展示完整性**
- 验证点：
  - 股票名称和代码显示正确
  - 价格显示格式正确（保留2位小数）
  - 涨跌颜色正确（涨红跌绿）
  - 所有指标数据显示完整

**测试用例2：数值格式化**
- 验证点：
  - 大数字正确转换为万/亿单位
  - 百分比显示正确
  - 货币符号显示正确

**测试用例3：响应式布局**
- 操作：调整窗口大小
- 预期：布局自适应，信息不遮挡
- 验证点：响应式设计正确

#### 3. 分析报告展示

**测试用例1：报告内容展示**
- 验证点：
  - 各部分标题清晰
  - 内容格式正确
  - 风险等级颜色标识正确
  - 时间戳显示正确

**测试用例2：滚动功能**
- 操作：查看长报告内容
- 预期：滚动条正常工作
- 验证点：滚动流畅，样式美观

**测试用例3：免责声明**
- 验证点：免责声明在报告底部显示

### 三、集成测试

#### 完整流程测试

**场景1：首次使用流程**
1. 启动应用
2. 输入股票代码 `600519`
3. 点击"查询数据"
4. 验证股票信息正确显示
5. 点击"AI分析"
6. 等待分析完成（约2-5秒）
7. 验证分析报告完整显示

**场景2：连续查询多只股票**
1. 查询第一只股票 `600519`
2. 查看分析报告
3. 查询第二只股票 `000001`
4. 验证数据正确更新
5. 查看新的分析报告
6. 验证报告内容对应新股票

**场景3：错误处理流程**
1. 输入无效股票代码 `999999`
2. 点击查询
3. 验证错误提示显示
4. 输入正确代码
5. 验证能正常恢复使用

### 四、性能测试

#### 1. 响应时间测试

| 操作 | 预期响应时间 | 实际测试结果 |
|------|-------------|-------------|
| 股票数据查询 | < 2秒 | _________ |
| AI完整分析 | < 30秒 | _________ |
| AI快速分析 | < 10秒 | _________ |
| 界面切换 | < 100ms | _________ |

#### 2. 稳定性测试

**测试用例：连续操作测试**
- 操作：连续查询10只不同股票
- 预期：应用稳定运行，无崩溃
- 验证点：
  - 内存使用正常
  - 无内存泄漏
  - 响应时间稳定

### 五、跨平台测试

#### Windows平台
- [ ] 应用正常启动
- [ ] 所有功能正常
- [ ] 界面显示正确
- [ ] WebView2正常工作

#### macOS平台
- [ ] 应用正常启动
- [ ] 所有功能正常
- [ ] 界面显示正确
- [ ] 原生菜单正常

#### Linux平台
- [ ] 应用正常启动
- [ ] 所有功能正常
- [ ] 界面显示正确
- [ ] GTK主题适配

## 自动化测试

### Go后端单元测试

创建测试文件 `services/stock_service_test.go`：

```go
package services

import (
	"testing"
)

func TestGetStockByCode(t *testing.T) {
	service := NewStockService()
	
	// 测试有效股票代码
	stock, err := service.GetStockByCode("600519")
	if err != nil {
		t.Errorf("获取股票数据失败: %v", err)
	}
	
	if stock.Code != "600519" {
		t.Errorf("股票代码不匹配，期望: 600519, 实际: %s", stock.Code)
	}
	
	if stock.Name == "" {
		t.Error("股票名称为空")
	}
}

func TestGetStockByInvalidCode(t *testing.T) {
	service := NewStockService()
	
	// 测试无效股票代码
	_, err := service.GetStockByCode("999999")
	if err == nil {
		t.Error("应该返回错误，但没有返回")
	}
}
```

运行测试：
```bash
go test ./services/...
```

### 前端组件测试

可以使用React Testing Library进行组件测试（可选）。

## 测试报告模板

### 测试执行记录

| 测试项 | 测试结果 | 问题描述 | 解决方案 |
|--------|---------|---------|---------|
| 股票数据查询 | ✅ / ❌ |  |  |
| AI分析功能 | ✅ / ❌ |  |  |
| 界面交互 | ✅ / ❌ |  |  |
| 错误处理 | ✅ / ❌ |  |  |
| 性能表现 | ✅ / ❌ |  |  |

### 已知问题

1. **问题描述**：
   - 严重程度：高/中/低
   - 影响范围：
   - 复现步骤：
   - 临时解决方案：

## 测试通过标准

应用需满足以下条件才能发布：

- [ ] 所有核心功能测试通过
- [ ] 无严重Bug
- [ ] 性能指标达标
- [ ] 至少在一个平台上完整测试通过
- [ ] 错误处理友好
- [ ] 用户体验流畅

## 持续测试建议

1. 每次代码修改后运行单元测试
2. 每周进行一次完整的集成测试
3. 定期测试不同股票代码
4. 监控OpenAI API调用成功率
5. 收集用户反馈并改进

---

**测试负责人**：_________  
**测试日期**：_________  
**测试版本**：v1.0.0
